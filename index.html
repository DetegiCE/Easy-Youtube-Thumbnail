<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Easy Youtube Thumbnail</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
</head>
<body>
    <div id="container" class="m-3">
        <h1>Easy Youtube Thumbnail</h1>
        <button type="button" class="btn btn-warning" id="dl" onclick="canvasDl()">Download</button>
        <canvas id="canvas" width="1920" height="1080">

        </canvas>
        <hr>
        <h1>Settings</h1>
        <form name="setting" id="setting">
            <div class="mb-3 row">
                <label for="selectLayout" class="col-sm-2 col-form-label">Select Layout</label>
                <div class="col-sm-10">
                    <select id="selectLayout" class="form-select">
                        <option selected value="CubeCommunity">CubeCommunity</option>
                        <option value="izuna">izuna</option>
                        <option value="johadesu">johadesu</option>
                    </select>
                </div>
            </div>
            <div class="mb-3 row">
                <label for="imageSize" class="col-sm-2 col-form-label">Select Size</label>
                <div class="col-sm-10">
                    <select id="imageSize" class="form-select">
                        <option selected value="1080p">1080p</option>
                    </select>
                </div>
            </div>
            <div class="mb-3 row">
                <label for="game" class="col-sm-2 col-form-label">Select Game</label>
                <div class="col-sm-10">
                    <select id="game" class="form-select">
                        <option selected value="BeatSaber">BeatSaber</option>
                        <option value="CHUNITHM">CHUNITHM</option>
                        <option value="DANGAKU">DANGAKU</option>
                        <option value="DJMAX RESPECT">DJMAX RESPECT</option>
                        <option value="GrooveCoaster">GrooveCoaster</option>
                        <option value="maimai">maimai</option>
                        <option value="MuseDash">MuseDash</option>
                        <option value="ProjectSekai">ProjectSekai</option>
                        <option value="SDVX">SDVX</option>
                        <option value="WACCA">WACCA</option>
                    </select>
                </div>
            </div>
            <div class="mb-3 row">
                <label for="songName" class="col-sm-2 col-form-label">Song Name</label>
                <div class="col-sm-10">
                    <input type="text" class="form-control" id="songName">
                </div>
            </div>
            <div class="mb-3 row">
                <label for="songAuthor" class="col-sm-2 col-form-label">Song Author</label>
                <div class="col-sm-10">
                    <input type="text" class="form-control" id="songAuthor">
                </div>
            </div>
            <div class="mb-3 row">
                <label for="songArtist" class="col-sm-2 col-form-label">Song Artist</label>
                <div class="col-sm-10">
                    <input type="text" class="form-control" id="songArtist">
                </div>
            </div>
            <div class="mb-3 row">
                <label for="songName" class="col-sm-2 col-form-label">Text Color</label>
                <div class="col-sm-10">
                    <input type="color" class="form-control form-control-color" id="textcolor">
                </div>
            </div>
            <div class="mb-3 row">
                <label for="songCover" class="col-sm-2 col-form-label">Song Cover</label>
                <div class="col-sm-10">
                    <input type="file" class="form-control" id="songCover" accept="image">
                </div>
            </div>
            <div class="mb-3 row">
                <label for="bgImage" class="col-sm-2 col-form-label">BG Image</label>
                <div class="col-sm-10">
                    <input type="file" class="form-control" id="bgImage" accept="image">
                </div>
            </div>
            <div class="mb-3 row">
                <label for="blur" class="col-sm-2 col-form-label">BG Blur</label>
                <div class="col-sm-10">
                    <input type="range" class="form-range" id="blur" min="0" max="100">
                    <div id="blurtext"></div>
                </div>
            </div>
            <button type="button" class="btn btn-primary" id="submit" onclick="refresh()">Submit</button>
        </form>
    </div>

    <script>
        var slider = document.getElementById("blur");
        var output = document.getElementById("blurtext");
        output.innerHTML = slider.value;
        slider.oninput = function() {
            output.innerHTML = this.value;
        }

        const canvas = document.getElementById("canvas");
        const ctx = canvas.getContext("2d");
        const bgImage = document.getElementById("bgImage");
        const img = new Image();

        bgImage.onchange = function(e) {

            var files = e.target.files;
            var file = files[0];
            if(file.type.match('image.*')) {
                var reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = function(e2) {
                    if(e2.target.readyState === FileReader.DONE)  {
                        img.onload = function() {
                            ctx.filter = 'blur('+String(slider.value)+'px)'
                            ctx.drawImage(img, 0, 0, img.width, img.height, 0, 0, 1920, 1080);
                            ctx.filter = 'blur(0px)'
                            ctx.font = "50px Arial";
                            ctx.textAlign = 'center'
                            ctx.fillText('test', 960, 600)
                        }
                        img.src = e2.target.result;
                    }
                }
            }
            else {
                alert("Not an image");
            }
        }

        function canvasDl() {
            var dataURL = canvas.toDataURL('image/png');
            dataURL = dataURL.replace(/^data:image\/[^;]*/, 'data:application/octet-stream');
            dataURL = dataURL.replace(/^data:application\/octet-stream/, 'data:application/octet-stream;headers=Content-Disposition%3A%20attachment%3B%20filename=Canvas.png');

            var aTag = document.createElement('a');
            aTag.download = 'from_canvas.png';
            aTag.href = dataURL;
            aTag.click();
        }
    </script>
</body>
</html>
